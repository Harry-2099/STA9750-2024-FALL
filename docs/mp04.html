<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Harry Sohal">

<title>Monte Carlo Analysis of Retirement Options – STA 9750 2024 Submission Material</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">STA 9750 2024 Submission Material</span>
    </a>
  </div>
        <div class="quarto-navbar-tools tools-end">
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Monte Carlo Analysis of Retirement Options</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Harry Sohal </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="monte-carlo-retirement-analysis" class="level2">
<h2 class="anchored" data-anchor-id="monte-carlo-retirement-analysis">Monte Carlo Retirement Analysis</h2>
<p>In this analysis we will use a computational approach to evaluate the performance of retirement plans while accounting for variability and uncertainty in inputs such as salary growth, investment returns, and lifespan. By simulating thousands of possible scenarios, this method allows us to assess the range of potential outcomes and determine the likelihood of achieving a successful retirement.</p>
<section id="setting-up-and-api-calls" class="level3">
<h3 class="anchored" data-anchor-id="setting-up-and-api-calls">Setting Up and API Calls</h3>
<p>Lets get all the libraries we need to start this analysis.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gganimate)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggthemes)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(httr)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(jsonlite)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Once we have these we can start to get the data we need using APIs from Alpha Vantage and FRED Economic Reserve, both great sources that have several interesting datasets. Below you can see several functions that ive created to pull data from the API sources with ease. I will also use the <code>readlines</code> function to read the text for the super secret API key.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>FRED_key <span class="ot">&lt;-</span> <span class="fu">readLines</span>(<span class="st">"~/R/Project_0/FRED_key.txt"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>get_fred<span class="ot">&lt;-</span> <span class="cf">function</span>(id){</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  base_url <span class="ot">&lt;-</span> <span class="st">"https://api.stlouisfed.org/fred/series/observations?series_id="</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <span class="fu">GET</span>(<span class="fu">paste0</span>(base_url,id,<span class="st">"&amp;api_key="</span>,FRED_key,<span class="st">"&amp;file_type=json"</span>))</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  res_content <span class="ot">&lt;-</span> <span class="fu">content</span>(res, <span class="at">as =</span> <span class="st">"text"</span>, <span class="at">encoding =</span> <span class="st">"UTF-8"</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  json <span class="ot">&lt;-</span> <span class="fu">fromJSON</span>(res_content)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span>json<span class="sc">$</span>observations</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">as.numeric</span>(value),<span class="co"># immediately convert to usable format</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>                          <span class="at">date =</span> <span class="fu">as.Date</span>(date))</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(data)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>AV_key <span class="ot">&lt;-</span> <span class="fu">readLines</span>(<span class="st">"~/R/Project_0/Alphavantage_key.txt"</span>)</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>GET_AV <span class="ot">&lt;-</span> <span class="cf">function</span>(ticker){</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>  url <span class="ot">&lt;-</span><span class="fu">paste0</span>(<span class="st">"https://www.alphavantage.co/query?function=TIME_SERIES_MONTHLY_ADJUSTED"</span>,<span class="st">"&amp;symbol="</span>,ticker,<span class="st">"&amp;apikey="</span>,AV_key)</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>  res <span class="ot">&lt;-</span> <span class="fu">GET</span>(url)</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>  res_content<span class="ot">&lt;-</span>(<span class="fu">content</span>(res,<span class="at">as =</span> <span class="st">"text"</span>,<span class="at">encoding =</span> <span class="st">"UTF-8"</span>))</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>  j <span class="ot">&lt;-</span> <span class="fu">fromJSON</span>(res_content,<span class="at">flatten =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> j<span class="sc">$</span><span class="st">`</span><span class="at">Monthly Adjusted Time Series</span><span class="st">`</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>  <span class="do">#### unpacking the data with a for loop</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>  close <span class="ot">&lt;-</span> <span class="fu">c</span>() <span class="co">#empty list to contain the list</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>  low <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>  volume <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>  div <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(data))){</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>    close <span class="ot">&lt;-</span> <span class="fu">append</span>(close,data[[i]][[<span class="st">"4. close"</span>]])</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>    low <span class="ot">&lt;-</span> <span class="fu">append</span>(low,data[[i]][[<span class="st">"3. low"</span>]])</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>    volume <span class="ot">&lt;-</span> <span class="fu">append</span>(volume,data[[i]][[<span class="st">"6. volume"</span>]])</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>    div <span class="ot">&lt;-</span><span class="fu">append</span>(div,data[[i]][[<span class="st">"7. dividend amount"</span>]])</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">date =</span> <span class="fu">as.Date</span>(<span class="fu">names</span>(data)),</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>                   <span class="at">close =</span> <span class="fu">as.numeric</span>(close),</span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>                   <span class="at">low =</span> <span class="fu">as.numeric</span>(low),</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>                   <span class="at">volume =</span> <span class="fu">as.numeric</span>(volume),</span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>                   <span class="at">dividend =</span> <span class="fu">as.numeric</span>(div))</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(df)</span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Now that we have our functions we can start to get the data that we need. This data will come from the criteria for ORP the investment strategy, including American Equities, Foreign Equities, Bonds and Short Term Debt. For the American Equities we will use the SP500 and the MidCap 400 as the main investments. This is because of the saftey and power of Index funds. Choosing individual stocks requires constant vigilance, and unless you are <a href="https://en.wikipedia.org/wiki/Jim_Simons">Jim Simons</a>, it is extremly unlikely that you “beat the market”. Thus, we will choose index funds when possible. Of course using hindsight we could have picked a stock like Apple,Tesla,or NVIDA from 2000 and watch as our retirement sky rockets, however this is unreasonable, as we are putting ourselves in the shoes of a CUNY employee who does not have the ability to see into the future. Similarly we will choose the Fidelity International Index (over some other international equities for reasons below), however since the history on several International equities don’t go as far back as out other index funds we will compute from the data we have and make do. Ideally we would have the same look back for all investments. For Bonds we will use the bond index from ICE and Bank of America, and pick 1 year T-bills for out short term debt.</p>
</section>
<section id="cleaning-and-analysis" class="level3">
<h3 class="anchored" data-anchor-id="cleaning-and-analysis">Cleaning and Analysis</h3>
<p>Here we will clean the data,plot and all general EDA procedures. This is nothing new and has been done extensively through out the projects. Notably, I will compute the CAGR here which is the Compound Annual Growth Rate, allowing us to see based on start and end values which investment has the best growth. In cases where the values themselves are rates, like the Tbill rates, we will simply take the mean or Geometric Mean.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>sp500_close <span class="ot">&lt;-</span> sp500 <span class="sc">%&gt;%</span> </span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(date,close) <span class="sc">%&gt;%</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">"Index"</span><span class="ot">=</span><span class="fu">rep</span>(<span class="st">"SP500"</span>,<span class="fu">length</span>(date)))</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>smallcap_close <span class="ot">&lt;-</span> smallcap600 <span class="sc">%&gt;%</span> </span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(date,close) <span class="sc">%&gt;%</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">"Index"</span><span class="ot">=</span><span class="fu">rep</span>(<span class="st">"SmallCap600"</span>,<span class="fu">length</span>(date)))</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>midcap_close <span class="ot">&lt;-</span> midcap400 <span class="sc">%&gt;%</span> </span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(date,close) <span class="sc">%&gt;%</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">"Index"</span><span class="ot">=</span><span class="fu">rep</span>(<span class="st">"Midcap400"</span>,<span class="fu">length</span>(date)))</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>IN <span class="ot">&lt;-</span> fid_inter <span class="sc">%&gt;%</span> </span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(date,close) <span class="sc">%&gt;%</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">"Index"</span> <span class="ot">=</span> <span class="fu">rep</span>(<span class="st">"Fidelity International"</span>,<span class="fu">length</span>(date)))</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>IN_CAGR <span class="ot">&lt;-</span> IN <span class="sc">%&gt;%</span> <span class="fu">reframe</span>(<span class="at">start_close =</span> close[date <span class="sc">==</span> <span class="st">"2011-10-31"</span>],</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">Index=</span> <span class="st">"Fidelity International"</span>,</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">end_close =</span> close[date <span class="sc">==</span> <span class="st">"2024-11-29"</span>],</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">num_years =</span> <span class="fu">as.numeric</span>(<span class="fu">difftime</span>(<span class="st">"2024-11-29"</span>, <span class="st">"2011-08-31"</span>, <span class="at">units =</span> <span class="st">"days"</span>)) <span class="sc">/</span> <span class="dv">365</span>,</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">CAGR =</span> ((end_close <span class="sc">/</span> start_close)<span class="sc">^</span>(<span class="dv">1</span> <span class="sc">/</span> num_years) <span class="sc">-</span> <span class="dv">1</span>)<span class="sc">*</span><span class="dv">100</span>)</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>my_theme <span class="ot">&lt;-</span> <span class="fu">theme_clean</span>()<span class="sc">+</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>   <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold.italic"</span>, <span class="at">size =</span> <span class="dv">12</span>),  </span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title.y =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold.italic"</span>, <span class="at">size =</span> <span class="dv">12</span>))</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>stocks_close <span class="ot">&lt;-</span> sp500_close <span class="sc">%&gt;%</span> </span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">full_join</span>(midcap_close, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">'date'</span>,<span class="st">"Index"</span>,<span class="st">"close"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">full_join</span>(smallcap_close, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">'date'</span>,<span class="st">"Index"</span>,<span class="st">"close"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">full_join</span>(IN, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">'date'</span>,<span class="st">"Index"</span>,<span class="st">"close"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Lets see some plots of the data</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(stocks_close,<span class="fu">aes</span>(<span class="at">x =</span> date,<span class="at">y=</span> close,<span class="at">color =</span> Index))<span class="sc">+</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()<span class="sc">+</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"American and International Index Performance (Close Price)"</span>, <span class="at">x =</span> <span class="st">"Date"</span>,<span class="at">y =</span> <span class="st">"Close Price"</span>)<span class="sc">+</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  my_theme<span class="sc">+</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp04_files/figure-html/plots-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<pre><code></code></pre>
<pre><code></code></pre>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="do">##BOND ANALYSIS</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(ice_bonds,<span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> value))<span class="sc">+</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"blue"</span>)<span class="sc">+</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_area</span>(<span class="at">fill =</span> <span class="st">"#69b3a2"</span>, <span class="at">alpha=</span>.<span class="dv">5</span>)<span class="sc">+</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  my_theme<span class="sc">+</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"ICE Bond Value Over Time"</span>, <span class="at">y=</span><span class="st">"Bond Value"</span>, <span class="at">x =</span> <span class="st">"Date"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp04_files/figure-html/plots4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">#visualize investments</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(investments,<span class="fu">aes</span>(<span class="at">x =</span> date,<span class="at">y=</span> close,<span class="at">color =</span> Index))<span class="sc">+</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()<span class="sc">+</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Equity and Bonds Performance (Monthly Close Price/Value)"</span>, <span class="at">x =</span> <span class="st">"Date"</span>,<span class="at">y =</span> <span class="st">"Close Price"</span>)<span class="sc">+</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  my_theme<span class="sc">+</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp04_files/figure-html/plot invest-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Standard Deviation</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>investments <span class="sc">%&gt;%</span> </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Index)<span class="sc">%&gt;%</span> </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">close_std =</span> <span class="fu">sd</span>(close)) <span class="sc">%&gt;%</span> </span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>Index, <span class="at">y =</span> close_std))<span class="sc">+</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x=</span>Index,<span class="at">xend=</span> Index,<span class="at">y =</span> <span class="dv">0</span>, <span class="at">yend=</span>close_std),<span class="at">linewidth =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">5</span>, <span class="at">fill =</span> <span class="fu">alpha</span>(<span class="st">"lightblue"</span>,.<span class="dv">7</span>),<span class="at">shape =</span><span class="dv">21</span>, <span class="at">stroke=</span> <span class="dv">2</span>,<span class="at">color=</span><span class="st">"black"</span>)<span class="sc">+</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  <span class="co">#geom_point(size = 6,shape = 8, color = "red")+</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  my_theme<span class="sc">+</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"FALSE"</span>)<span class="sc">+</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Standard Deviation of Investment Close Value"</span>,<span class="at">y =</span> <span class="st">"Close Standard Deviation"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp04_files/figure-html/std intvetment-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<section id="cagr" class="level4">
<h4 class="anchored" data-anchor-id="cagr">CAGR</h4>
<p>Here we can see some of the CAGR visualized, as previously stated this will be crucial to our analysis.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="do">###plotting all the cagr </span><span class="al">###</span><span class="do"> ANIMATED LOLLIPOP</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>investments <span class="ot">&lt;-</span> sp500_close <span class="sc">%&gt;%</span> </span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">full_join</span>(midcap_close, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">'date'</span>,<span class="st">"Index"</span>,<span class="st">"close"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">full_join</span>(smallcap_close, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">'date'</span>,<span class="st">"Index"</span>,<span class="st">"close"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">full_join</span>(IN, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">'date'</span>,<span class="st">"Index"</span>,<span class="st">"close"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">full_join</span>(bonds,<span class="at">by=</span><span class="fu">c</span>(<span class="st">'date'</span>,<span class="st">"Index"</span>,<span class="st">"close"</span>))</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>stock_CAGR <span class="ot">&lt;-</span>investments <span class="sc">%&gt;%</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Index) <span class="sc">%&gt;%</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reframe</span>(</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">start_close =</span> close[date <span class="sc">==</span> <span class="st">"2000-08-31"</span>],</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">end_close =</span> close[date <span class="sc">==</span> <span class="st">"2024-11-29"</span>],</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">num_years =</span> <span class="fu">as.numeric</span>(<span class="fu">difftime</span>(<span class="st">"2024-11-29"</span>, <span class="st">"2000-08-31"</span>, <span class="at">units =</span> <span class="st">"days"</span>)) <span class="sc">/</span> <span class="dv">365</span>,</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">CAGR =</span>((end_close <span class="sc">/</span> start_close)<span class="sc">^</span>(<span class="dv">1</span> <span class="sc">/</span> num_years) <span class="sc">-</span> <span class="dv">1</span>)<span class="sc">*</span><span class="dv">100</span>)</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>bond_CAGR <span class="ot">&lt;-</span>investments <span class="sc">%&gt;%</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Index) <span class="sc">%&gt;%</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">reframe</span>(<span class="at">start_close =</span> close[date<span class="sc">==</span><span class="st">"2000-08-31"</span>],</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>          <span class="at">end_close =</span> close[date <span class="sc">==</span><span class="st">"2024-12-03"</span>],</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>          <span class="at">num_years =</span> <span class="fu">as.numeric</span>(<span class="fu">difftime</span>(<span class="st">"2024-11-29"</span>, <span class="st">"2000-08-31"</span>, <span class="at">units =</span> <span class="st">"days"</span>)) <span class="sc">/</span> <span class="dv">365</span>,</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>          <span class="at">CAGR =</span>(((end_close <span class="sc">/</span> start_close)<span class="sc">^</span>(<span class="dv">1</span> <span class="sc">/</span> num_years) <span class="sc">-</span> <span class="dv">1</span>)<span class="sc">*</span><span class="dv">100</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>CAGR <span class="ot">&lt;-</span> stock_CAGR <span class="sc">%&gt;%</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">full_join</span>(bond_CAGR, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"start_close"</span>,<span class="st">"end_close"</span>,<span class="st">"num_years"</span>,<span class="st">"Index"</span>,<span class="st">"CAGR"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">full_join</span>(IN_CAGR,<span class="at">by =</span> <span class="fu">c</span>(<span class="st">"start_close"</span>,<span class="st">"end_close"</span>,<span class="st">"num_years"</span>,<span class="st">"Index"</span>,<span class="st">"CAGR"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>anim<span class="ot">&lt;-</span> <span class="fu">ggplot</span>(CAGR,<span class="fu">aes</span>(<span class="at">x=</span>Index, <span class="at">y =</span> CAGR))<span class="sc">+</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>,<span class="at">width =</span> .<span class="dv">0175</span>)<span class="sc">+</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">5</span>, <span class="at">fill =</span> <span class="fu">alpha</span>(<span class="st">"lightblue"</span>,.<span class="dv">5</span>),<span class="at">shape =</span><span class="dv">21</span>, <span class="at">stroke=</span> <span class="dv">2</span>,<span class="at">color=</span><span class="st">"black"</span>)<span class="sc">+</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  my_theme<span class="sc">+</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"FALSE"</span>)<span class="sc">+</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"CAGR of Investments"</span>,<span class="at">y =</span> <span class="st">"CAGR"</span>)<span class="sc">+</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transition_states</span>(CAGR,<span class="at">transition_length =</span> <span class="dv">4</span>, <span class="at">state_length =</span> <span class="dv">1</span>)<span class="sc">+</span> </span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">enter_grow</span>()<span class="sc">+</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">exit_fade</span>(<span class="at">alpha=</span>.<span class="dv">2</span>)</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>anim</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp04_files/figure-html/unnamed-chunk-2-1.gif" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Above we can see the CAGR, for some our investments. This will be critical for our analysis.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>tbills <span class="ot">&lt;-</span> tbills_1 <span class="sc">%&gt;%</span> </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="sc">-</span><span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">yield =</span> value)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>tbills <span class="ot">&lt;-</span>tbills<span class="sc">%&gt;%</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">month =</span> <span class="fu">month</span>(date),</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">day =</span> <span class="fu">day</span>(date),</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">year =</span> <span class="fu">year</span>(date)) <span class="sc">%&gt;%</span> </span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year,month) <span class="sc">%&gt;%</span> </span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">close_yield =</span> yield[<span class="fu">which.max</span>(day)]) <span class="sc">%&gt;%</span> </span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(date)) <span class="sc">%&gt;%</span></span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(close_yield,<span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(date,close_yield) <span class="sc">%&gt;%</span> </span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(date <span class="sc">&gt;=</span> <span class="fu">as.Date</span>(<span class="st">"1999-12-30"</span>))</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>tbills <span class="sc">%&gt;%</span> <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> date,<span class="at">y=</span> close_yield))<span class="sc">+</span></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"blue"</span>)<span class="sc">+</span></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_area</span>(<span class="at">fill =</span> <span class="fu">alpha</span>(<span class="st">"lightblue"</span>,.<span class="dv">5</span>))<span class="sc">+</span></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>  my_theme<span class="sc">+</span></span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span> <span class="st">"1 Year T-Bill Monthly Percent Yield"</span>, <span class="at">x =</span> <span class="st">"Date"</span>,<span class="at">y =</span> <span class="st">"Percent Yield"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp04_files/figure-html/tbills-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>For Tbills we will use the formula for geometric mean, and compute the long run average return.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">#average growth over time</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>geo_mean <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  mean <span class="ot">&lt;-</span> <span class="fu">prod</span>(<span class="dv">1</span> <span class="sc">+</span> x)<span class="sc">^</span>(<span class="dv">1</span> <span class="sc">/</span> <span class="fu">length</span>(x)) <span class="sc">-</span> <span class="dv">1</span> </span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(mean)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="do">### Tbills average monthly growth</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>tbills <span class="sc">%&gt;%</span> <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Avg_Growth_Rate =</span> <span class="fu">geo_mean</span>(close_yield))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
  Avg_Growth_Rate
            &lt;dbl&gt;
1            1.69</code></pre>
</div>
</div>
<p>Now we need to compute the average wage increase to add into our analysis.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>wages <span class="ot">&lt;-</span> <span class="fu">get_fred</span>(<span class="st">"FRBATLWGT12MMAWMHWG97O"</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>wage <span class="ot">&lt;-</span> wages <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="sc">-</span><span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">diff =</span> value)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>wage <span class="ot">&lt;-</span>wage <span class="sc">%&gt;%</span> </span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">month =</span> <span class="fu">month</span>(date),</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">day =</span> <span class="fu">day</span>(date),</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">year =</span> <span class="fu">year</span>(date)) <span class="sc">%&gt;%</span> </span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year,month) <span class="sc">%&gt;%</span> </span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">diff =</span> diff[<span class="fu">which.max</span>(day)]) <span class="sc">%&gt;%</span> </span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(date)) <span class="sc">%&gt;%</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(diff,<span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(date,diff)</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(wage,<span class="fu">aes</span>(<span class="at">x =</span> date,<span class="at">y=</span>diff))<span class="sc">+</span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()<span class="sc">+</span></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>  my_theme<span class="sc">+</span></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Median Wage Growth"</span>,<span class="at">x =</span> <span class="st">"Date"</span>, <span class="at">y =</span> <span class="st">"Percent Growth in Median"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp04_files/figure-html/wage-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Along with the mean for the wage growth to use an annual increase. Note this percentage is still in its decimal form.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>wage  <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">Avg_wage_growth =</span> <span class="fu">geo_mean</span>(diff<span class="sc">/</span><span class="dv">100</span>))<span class="co"># GEO MEAN OF WAGES</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
  Avg_wage_growth
            &lt;dbl&gt;
1          0.0452</code></pre>
</div>
</div>
</section>
</section>
<section id="trs-and-orp-calculations" class="level3">
<h3 class="anchored" data-anchor-id="trs-and-orp-calculations">TRS and ORP Calculations</h3>
<p>Now that we have all our information, we can build a function that use those to compute our retirement outlook.This process will revolve around using loops to literately increase each our wage,age, and correspondingly change our investment types, and deposit amount based on CUNY’s guidelines.</p>
<p>Here are some guidelines for deposit amount:</p>
<ul>
<li><p>$45,000 or less: 3%</p></li>
<li><p>$45,001 to $55,000: 3.5%</p></li>
</ul>
<!-- -->
<ul>
<li><p>$55,001 to $75,000: 4.5%</p></li>
<li><p>$75,001 to $100,000: 5.75%</p></li>
<li><p>$100,001 or more: 6%</p></li>
</ul>
<p>Guidleines for ORP Investment Allocation:</p>
<ul>
<li><p>Age 25 to Age 49:</p>
<ul>
<li><p>54% US Equities</p></li>
<li><p>36% International Equities</p></li>
<li><p>10% Bonds</p></li>
</ul></li>
<li><p>Age 50 to Age 59:</p>
<ul>
<li><p>47% US Equities</p></li>
<li><p>32% International Equities</p></li>
<li><p>21% Bonds</p></li>
</ul></li>
<li><p>Age 60 to Age 74:</p>
<ul>
<li><p>34% US Equities</p></li>
<li><p>23% International Equities</p></li>
<li><p>43% Bonds</p></li>
</ul></li>
<li><p>Age 75 or older:</p>
<ul>
<li><p>19% US Equities</p></li>
<li><p>13% International Equities</p></li>
<li><p>62% Bonds</p></li>
<li><p>6% Short-Term Debt</p></li>
</ul></li>
</ul>
<p>For FAS (Final Average Salary) we also have the following guidelines :</p>
<ol type="1">
<li>1.67% * FAS * N if N &lt; = 20</li>
<li>1.75% * FAS * N if N = 20</li>
<li>(35% + 2% * N) * FAS if N &gt; 20</li>
</ol>
<section id="trs-system-function" class="level4">
<h4 class="anchored" data-anchor-id="trs-system-function">TRS System Function</h4>
<p>Here we can use this function to compute the TRS system retirement taking arguments Salary:x, and Time Worked:t.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>TRS_system <span class="ot">&lt;-</span> <span class="cf">function</span>(x,t){</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  salary_list <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  TRS <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">#calc the wage growth</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq</span>(<span class="dv">1</span>,t<span class="dv">-1</span>)){<span class="co"># -1 accounts for fixed sal in first year</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    x <span class="ot">&lt;-</span> x<span class="sc">*</span>(<span class="dv">1</span><span class="fl">+.045</span>)</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>    x<span class="ot">&lt;-</span> <span class="fu">min</span>(x, <span class="dv">275000</span>) <span class="do">## prevents unrealistc salary growth</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>    salary_list <span class="ot">&lt;-</span> <span class="fu">append</span>(salary_list,x)<span class="co">#for FAS</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>   <span class="co">#calc the yearly deposit to TRS</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(x<span class="sc">&gt;=</span> <span class="dv">55001</span> <span class="sc">&amp;</span> x <span class="sc">&lt;=</span><span class="dv">75000</span>){<span class="co"># tier 1 salary</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>       TRS <span class="ot">&lt;-</span> TRS <span class="sc">+</span> (x <span class="sc">*</span> .<span class="dv">045</span>)</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>        }<span class="cf">else</span> <span class="cf">if</span>(x<span class="sc">&gt;=</span> <span class="dv">75001</span> <span class="sc">&amp;</span> x <span class="sc">&lt;=</span> <span class="dv">100000</span>){<span class="co"># tier 2 salary</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>            TRS <span class="ot">&lt;-</span> TRS <span class="sc">+</span> (x <span class="sc">*</span> .<span class="dv">0575</span>)</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>        }<span class="cf">else</span>{<span class="co"># tier 3 salary</span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>            TRS <span class="ot">&lt;-</span> TRS <span class="sc">+</span> (x <span class="sc">*</span> .<span class="dv">06</span>)</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>   <span class="co">#benfit pay</span></span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>   FAS <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">tail</span>(salary_list,<span class="dv">3</span>))</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(t <span class="sc">&lt;=</span> <span class="dv">20</span>){ <span class="co">#benefit payments</span></span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>       benefit_pay <span class="ot">&lt;-</span> .<span class="dv">0167</span> <span class="sc">*</span> FAS<span class="sc">*</span> t</span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>         }<span class="cf">else</span> <span class="cf">if</span>(t <span class="sc">==</span> <span class="dv">20</span>){</span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>            benefit_pay <span class="ot">&lt;-</span> .<span class="dv">0175</span> <span class="sc">*</span> FAS<span class="sc">*</span> t</span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>         }</span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>          <span class="cf">else</span>{</span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a>            benefit_pay <span class="ot">&lt;-</span> (.<span class="dv">35</span> <span class="sc">+</span>(.<span class="dv">02</span> <span class="sc">*</span> t)) <span class="sc">*</span> FAS</span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a>         }</span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-31"><a href="#cb19-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-32"><a href="#cb19-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Final Salary:"</span>,x,<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb19-33"><a href="#cb19-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Total Contributions:"</span>,TRS)</span>
<span id="cb19-34"><a href="#cb19-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>,<span class="st">"FAS:"</span>,FAS,<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb19-35"><a href="#cb19-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Monthly Benefit Pay:  "</span>)</span>
<span id="cb19-36"><a href="#cb19-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-37"><a href="#cb19-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(benefit_pay<span class="sc">/</span><span class="dv">12</span>)</span>
<span id="cb19-38"><a href="#cb19-38" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb19-39"><a href="#cb19-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-40"><a href="#cb19-40" aria-hidden="true" tabindex="-1"></a><span class="fu">TRS_system</span>(<span class="dv">60000</span>,<span class="dv">25</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Final Salary: 172560.8 
Total Contributions: 150377.5
 FAS: 165236.6 
Monthly Benefit Pay:  </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 11704.26</code></pre>
</div>
</div>
</section>
<section id="orp-function" class="level4">
<h4 class="anchored" data-anchor-id="orp-function">ORP Function</h4>
<p>ORP function uses the same logic, however accounting for various investments, age, estimated death, withdrawal amount it becomes a bit complicated. Some key points to note are the are the investment calculating function within, which allows us to compute returns dynamically without writing excess code (this is already too long). Also note the <code>while</code> loop after the <code>for</code> loop which allows us to compute the earnings after retirement, since those investments continue to grow, but there are no more deposits based on salary. The main challenges of these functions are adjusting all the variables dynamically. This includes age, time, worked, balance,withdrawal rate etc.</p>
<p>This function can compute using arguments Salary:x, Time Worked:t, Age:age, Death:est_death, and Withdrawal Rate: withdrawal_rate</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>ORP_system<span class="ot">&lt;-</span> <span class="cf">function</span>(x,t,age,est_death,withdrawl_rate){</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  salary_list <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  years_worked<span class="ot">&lt;-</span><span class="dv">0</span> </span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  total_deposit<span class="ot">&lt;-</span><span class="dv">0</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  TRS <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>  profit <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>  retirment_age <span class="ot">&lt;-</span> age<span class="sc">+</span>t</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>  sal_after_r <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="co">#inner functions</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>  personal_deposit <span class="ot">&lt;-</span> <span class="cf">function</span>(salary) {</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (salary <span class="sc">&gt;=</span> <span class="dv">55001</span> <span class="sc">&amp;</span> salary <span class="sc">&lt;=</span> <span class="dv">75000</span>){</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(salary <span class="sc">*</span> <span class="fl">0.045</span>)}</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">if</span> (salary <span class="sc">&gt;</span> <span class="dv">75000</span> <span class="sc">&amp;</span> salary <span class="sc">&lt;=</span> <span class="dv">100000</span>){ </span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(salary <span class="sc">*</span> <span class="fl">0.0575</span>)}</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>{ </span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(salary <span class="sc">*</span> <span class="fl">0.06</span>)}</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>  investment_return <span class="ot">&lt;-</span><span class="cf">function</span>(age,total_deposit){</span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(age <span class="sc">%in%</span> <span class="fu">seq</span>(<span class="dv">25</span>,<span class="dv">49</span>)){<span class="co">#us equities(split into sp500 &amp; mid400), foreign equities, bonds; respectively</span></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>      profit <span class="ot">&lt;-</span> (total_deposit<span class="sc">*</span>.<span class="dv">27</span>)<span class="sc">*</span>.<span class="dv">0779</span> <span class="sc">+</span> </span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>                (total_deposit<span class="sc">*</span>.<span class="dv">27</span>)<span class="sc">*</span>.<span class="dv">0583</span> <span class="sc">+</span> </span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>                ((total_deposit<span class="sc">*</span>.<span class="dv">36</span>)<span class="sc">*</span>.<span class="dv">033</span>)<span class="sc">+</span> </span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>                (total_deposit<span class="sc">*</span>.<span class="dv">10</span>)<span class="sc">*</span>.<span class="dv">066</span></span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>                <span class="fu">return</span>(profit)</span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">if</span>(age <span class="sc">%in%</span> <span class="fu">seq</span>(<span class="dv">50</span>,<span class="dv">59</span>)){</span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a>      profit <span class="ot">&lt;-</span> (total_deposit<span class="sc">*</span>.<span class="dv">235</span>)<span class="sc">*</span>.<span class="dv">0779</span> <span class="sc">+</span> </span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a>                (total_deposit<span class="sc">*</span>.<span class="dv">235</span>)<span class="sc">*</span>.<span class="dv">0583</span> <span class="sc">+</span> </span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a>                ((total_deposit<span class="sc">*</span>.<span class="dv">32</span>)<span class="sc">*</span>.<span class="dv">033</span>) <span class="sc">+</span> </span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a>                (total_deposit<span class="sc">*</span>.<span class="dv">21</span>)<span class="sc">*</span>.<span class="dv">066</span></span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a>                <span class="fu">return</span>(profit)</span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">if</span>(age <span class="sc">%in%</span> <span class="fu">seq</span>(<span class="dv">60</span>,<span class="dv">74</span>)){</span>
<span id="cb22-34"><a href="#cb22-34" aria-hidden="true" tabindex="-1"></a>      profit <span class="ot">&lt;-</span>(total_deposit<span class="sc">*</span>.<span class="dv">17</span>)<span class="sc">*</span>.<span class="dv">0779</span> <span class="sc">+</span> </span>
<span id="cb22-35"><a href="#cb22-35" aria-hidden="true" tabindex="-1"></a>                (total_deposit<span class="sc">*</span>.<span class="dv">17</span>)<span class="sc">*</span>.<span class="dv">0583</span> <span class="sc">+</span> </span>
<span id="cb22-36"><a href="#cb22-36" aria-hidden="true" tabindex="-1"></a>                ((total_deposit<span class="sc">*</span>.<span class="dv">23</span>)<span class="sc">*</span>.<span class="dv">033</span>) <span class="sc">+</span> </span>
<span id="cb22-37"><a href="#cb22-37" aria-hidden="true" tabindex="-1"></a>                (total_deposit<span class="sc">*</span>.<span class="dv">43</span>)<span class="sc">*</span>.<span class="dv">066</span></span>
<span id="cb22-38"><a href="#cb22-38" aria-hidden="true" tabindex="-1"></a>                <span class="fu">return</span>(profit)</span>
<span id="cb22-39"><a href="#cb22-39" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb22-40"><a href="#cb22-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">if</span>(age <span class="sc">&gt;</span> <span class="dv">74</span>){<span class="co">#us equities(split into sp500 &amp; mid400), foreign equities, bonds,treasury; respectively</span></span>
<span id="cb22-41"><a href="#cb22-41" aria-hidden="true" tabindex="-1"></a>      profit <span class="ot">&lt;-</span> (total_deposit<span class="sc">*</span>.<span class="dv">095</span>)<span class="sc">*</span>.<span class="dv">0779</span> <span class="sc">+</span> </span>
<span id="cb22-42"><a href="#cb22-42" aria-hidden="true" tabindex="-1"></a>                (total_deposit<span class="sc">*</span>.<span class="dv">095</span>)<span class="sc">*</span>.<span class="dv">0583</span> <span class="sc">+</span> </span>
<span id="cb22-43"><a href="#cb22-43" aria-hidden="true" tabindex="-1"></a>                ((total_deposit<span class="sc">*</span>.<span class="dv">13</span>)<span class="sc">*</span>.<span class="dv">033</span>) <span class="sc">+</span> </span>
<span id="cb22-44"><a href="#cb22-44" aria-hidden="true" tabindex="-1"></a>                (total_deposit<span class="sc">*</span>.<span class="dv">62</span>)<span class="sc">*</span>.<span class="dv">066</span><span class="sc">+</span> </span>
<span id="cb22-45"><a href="#cb22-45" aria-hidden="true" tabindex="-1"></a>                (total_deposit <span class="sc">*</span>.<span class="dv">06</span>)<span class="sc">*</span>.<span class="dv">0219</span></span>
<span id="cb22-46"><a href="#cb22-46" aria-hidden="true" tabindex="-1"></a>                <span class="fu">return</span>(profit)</span>
<span id="cb22-47"><a href="#cb22-47" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb22-48"><a href="#cb22-48" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb22-49"><a href="#cb22-49" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-50"><a href="#cb22-50" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq</span>(<span class="dv">1</span>, t)){</span>
<span id="cb22-51"><a href="#cb22-51" aria-hidden="true" tabindex="-1"></a>      x <span class="ot">&lt;-</span> x<span class="sc">*</span>(<span class="dv">1</span><span class="fl">+.045</span>)</span>
<span id="cb22-52"><a href="#cb22-52" aria-hidden="true" tabindex="-1"></a>      age <span class="ot">&lt;-</span> age <span class="sc">+</span><span class="dv">1</span></span>
<span id="cb22-53"><a href="#cb22-53" aria-hidden="true" tabindex="-1"></a>      years_worked<span class="ot">&lt;-</span> years_worked <span class="sc">+</span> <span class="dv">1</span> </span>
<span id="cb22-54"><a href="#cb22-54" aria-hidden="true" tabindex="-1"></a>      salary_list <span class="ot">&lt;-</span> <span class="fu">append</span>(salary_list,x)</span>
<span id="cb22-55"><a href="#cb22-55" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb22-56"><a href="#cb22-56" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(years_worked <span class="sc">&lt;=</span> <span class="dv">7</span>){</span>
<span id="cb22-57"><a href="#cb22-57" aria-hidden="true" tabindex="-1"></a>           total_deposit <span class="ot">&lt;-</span> total_deposit <span class="sc">+</span> <span class="fu">personal_deposit</span>(x) <span class="sc">+</span> .<span class="dv">08</span><span class="sc">*</span>x</span>
<span id="cb22-58"><a href="#cb22-58" aria-hidden="true" tabindex="-1"></a>      }<span class="cf">else</span>{</span>
<span id="cb22-59"><a href="#cb22-59" aria-hidden="true" tabindex="-1"></a>        total_deposit <span class="ot">&lt;-</span> total_deposit <span class="sc">+</span> <span class="fu">personal_deposit</span>(x) <span class="sc">+</span> .<span class="dv">10</span><span class="sc">*</span>x</span>
<span id="cb22-60"><a href="#cb22-60" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb22-61"><a href="#cb22-61" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb22-62"><a href="#cb22-62" aria-hidden="true" tabindex="-1"></a>      balance <span class="ot">&lt;-</span> total_deposit <span class="sc">+</span> <span class="fu">investment_return</span>(<span class="at">age =</span> age,<span class="at">total_deposit =</span> total_deposit)</span>
<span id="cb22-63"><a href="#cb22-63" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb22-64"><a href="#cb22-64" aria-hidden="true" tabindex="-1"></a>      <span class="cf">while</span> (age <span class="sc">&lt;</span> est_death) {</span>
<span id="cb22-65"><a href="#cb22-65" aria-hidden="true" tabindex="-1"></a>      age <span class="ot">&lt;-</span> age <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb22-66"><a href="#cb22-66" aria-hidden="true" tabindex="-1"></a>      withdraw <span class="ot">&lt;-</span> balance <span class="sc">*</span> withdrawl_rate</span>
<span id="cb22-67"><a href="#cb22-67" aria-hidden="true" tabindex="-1"></a>      sal_after_r <span class="ot">&lt;-</span> <span class="fu">append</span>(sal_after_r,withdraw)</span>
<span id="cb22-68"><a href="#cb22-68" aria-hidden="true" tabindex="-1"></a>      balance <span class="ot">&lt;-</span> balance <span class="sc">-</span> withdraw</span>
<span id="cb22-69"><a href="#cb22-69" aria-hidden="true" tabindex="-1"></a>      balance <span class="ot">&lt;-</span> balance <span class="sc">+</span> <span class="fu">investment_return</span>(<span class="at">age =</span> age,<span class="at">total_deposit=</span>balance)</span>
<span id="cb22-70"><a href="#cb22-70" aria-hidden="true" tabindex="-1"></a>      average_annual <span class="ot">&lt;-</span> <span class="fu">mean</span>(sal_after_r)</span>
<span id="cb22-71"><a href="#cb22-71" aria-hidden="true" tabindex="-1"></a>         }</span>
<span id="cb22-72"><a href="#cb22-72" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb22-73"><a href="#cb22-73" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-74"><a href="#cb22-74" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Final Balance:"</span>, balance, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb22-75"><a href="#cb22-75" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Annual Retirement Salary Until Death:"</span>, average_annual, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb22-76"><a href="#cb22-76" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"________________________________________________________"</span>, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb22-77"><a href="#cb22-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Monthly Income After Retirement: "</span>)</span>
<span id="cb22-78"><a href="#cb22-78" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-79"><a href="#cb22-79" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(average_annual <span class="sc">/</span> <span class="dv">12</span>)</span>
<span id="cb22-80"><a href="#cb22-80" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-81"><a href="#cb22-81" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb22-82"><a href="#cb22-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-83"><a href="#cb22-83" aria-hidden="true" tabindex="-1"></a><span class="fu">ORP_system</span>(<span class="dv">60000</span>,<span class="dv">50</span>,<span class="dv">30</span>,<span class="dv">90</span>,.<span class="dv">04</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Final Balance: 2226721 
Annual Retirement Salary Until Death: 81241.15 
________________________________________________________ 
Monthly Income After Retirement: </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 6770.096</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="monte-carlo-simulations" class="level2">
<h2 class="anchored" data-anchor-id="monte-carlo-simulations">Monte Carlo Simulations</h2>
<p>Now we can begin to use a Monte Carlo process to compute some true values for our growth rates and investments, and then use it to update our functions to add a randomness to our computations.</p>
<p>We will set <code>n_boot</code> for number of bootstrap samples and <code>n_samp</code> for number of samples per “boot”. It is also crucial set out “seed” for reproduce ability. 123 is classic value for these MC methods so we will stick with that. First lets use this method to produce multiple Monte Carlo close samples for the SP500 showcased in the classic MC line plot.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>n_boot <span class="ot">&lt;-</span> <span class="dv">500</span> <span class="co"># Number of bootstrap samples</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>n_samp <span class="ot">&lt;-</span> <span class="dv">100</span> <span class="co"># Number of samples per bootstrap</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>n_total <span class="ot">&lt;-</span> n_boot <span class="sc">*</span> n_samp  <span class="co"># Total number of samples to generate</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>sp500MC <span class="ot">&lt;-</span> investments <span class="sc">%&gt;%</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Index <span class="sc">==</span> <span class="st">"SP500"</span>) <span class="sc">%&gt;%</span>            </span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n =</span> n_total, <span class="at">replace =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">resample_id =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span>n_boot, <span class="at">each =</span> n_samp)) <span class="sc">%&gt;%</span> </span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(resample_id) <span class="sc">%&gt;%</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">close =</span> <span class="fu">pmax</span>(<span class="dv">100</span>,close <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="fu">n</span>(), <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">123</span>))) <span class="sc">%&gt;%</span> <span class="co"># Add variation with min 70(from data)</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(date)</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(sp500MC,<span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> close, <span class="at">group =</span> resample_id, <span class="at">color =</span> resample_id)) <span class="sc">+</span></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">alpha =</span> <span class="fl">0.075</span>) <span class="sc">+</span> <span class="co"># Plot each resample</span></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"FALSE"</span>)<span class="sc">+</span></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span> <span class="st">"MC Plot of S&amp;P 500 Closing Price "</span>,<span class="at">y =</span> <span class="st">"Close Price"</span>, <span class="at">x =</span> <span class="st">'Date'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp04_files/figure-html/mc init-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Here is an interesting feature of using Monte Carlo with increasing reproductions. See the first plot with less replications:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>n_boot <span class="ot">&lt;-</span> <span class="dv">100</span>  <span class="co"># Number of bootstrap samples</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>n_samp <span class="ot">&lt;-</span> <span class="dv">1000</span> <span class="co"># Number of samples per bootstrap</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>n_total <span class="ot">&lt;-</span> n_boot <span class="sc">*</span> n_samp  <span class="co"># Total number of samples to generate</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>sp500MC <span class="ot">&lt;-</span> investments <span class="sc">%&gt;%</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Index <span class="sc">==</span> <span class="st">"SP500"</span>) <span class="sc">%&gt;%</span>            </span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n =</span> n_total, <span class="at">replace =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">resample_id =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span>n_boot, <span class="at">each =</span> n_samp)) <span class="sc">%&gt;%</span> </span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(resample_id) <span class="sc">%&gt;%</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">close =</span> <span class="fu">pmax</span>(<span class="dv">70</span>,close <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="fu">n</span>(), <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">123</span>))) <span class="sc">%&gt;%</span> <span class="co"># Add variation with min 70(from data)</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(date)</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>sp500MC <span class="sc">%&gt;%</span></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(date <span class="sc">==</span> <span class="st">"2024-11-29"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">meanclose =</span> <span class="fu">mean</span>(close)) <span class="sc">%&gt;%</span> </span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(date) <span class="sc">%&gt;%</span> </span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> close))<span class="sc">+</span></span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">30</span>, <span class="at">fill =</span> <span class="st">"blue"</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>)<span class="sc">+</span></span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span></span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span><span class="st">"Monte Carlo Simulated Close Prices"</span>,<span class="at">x =</span> <span class="st">"Close Price S&amp;P 500 (2024-11-29)"</span>, <span class="at">y =</span> <span class="st">"Freq."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp04_files/figure-html/mc bar low r-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>See with a vast amount of sampling:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>n_boot <span class="ot">&lt;-</span> <span class="dv">6000</span>  <span class="co"># Number of bootstrap samples</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>n_samp <span class="ot">&lt;-</span> <span class="dv">1000</span> <span class="co"># Number of samples per bootstrap</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>n_total <span class="ot">&lt;-</span> n_boot <span class="sc">*</span> n_samp  <span class="co"># Total number of samples to generate</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>sp500MC <span class="ot">&lt;-</span> investments <span class="sc">%&gt;%</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Index <span class="sc">==</span> <span class="st">"SP500"</span>) <span class="sc">%&gt;%</span>            </span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n =</span> n_total, <span class="at">replace =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">resample_id =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span>n_boot, <span class="at">each =</span> n_samp)) <span class="sc">%&gt;%</span> </span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(resample_id) <span class="sc">%&gt;%</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">close =</span> <span class="fu">pmax</span>(<span class="dv">70</span>,close <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="fu">n</span>(), <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">123</span>))) <span class="sc">%&gt;%</span> <span class="co"># Add variation with min 70(from data)</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(date)</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>sp500MC <span class="sc">%&gt;%</span></span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(date <span class="sc">==</span> <span class="st">"2024-11-29"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(date) <span class="sc">%&gt;%</span> </span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> close))<span class="sc">+</span></span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">30</span>, <span class="at">fill =</span> <span class="st">"blue"</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>)<span class="sc">+</span></span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span></span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">600</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span><span class="st">"Monte Carlo Simulated Close Prices"</span>,<span class="at">x =</span> <span class="st">"Close Price S&amp;P 500 (2024-11-29)"</span>, <span class="at">y =</span> <span class="st">"Freq."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp04_files/figure-html/mc large-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Now we can use this method to create new CAGR values and long term averages for all our investments.</p>
<p>SP500:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="do">## SP500 MC CAGR</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>sp500MC <span class="ot">&lt;-</span> investments <span class="sc">%&gt;%</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Index <span class="sc">==</span> <span class="st">"SP500"</span>) <span class="sc">%&gt;%</span>            </span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n =</span> n_total, <span class="at">replace =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">resample_id =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span>n_boot, <span class="at">each =</span> n_samp)) <span class="sc">%&gt;%</span> </span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(resample_id) <span class="sc">%&gt;%</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">close =</span> <span class="fu">pmax</span>(<span class="dv">70</span>,close <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="fu">n</span>(), <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">123</span>))) <span class="sc">%&gt;%</span> <span class="co"># Add variation with min 70(from data)</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(date)</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>sp500MC <span class="sc">%&gt;%</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(date <span class="sc">==</span> <span class="st">"1999-12-31"</span> <span class="sc">|</span> date <span class="sc">==</span> <span class="st">"2024-11-29"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(date) <span class="sc">%&gt;%</span> </span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">average_close =</span> <span class="fu">mean</span>(close)) <span class="sc">%&gt;%</span> </span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">start =</span> average_close[date <span class="sc">==</span> <span class="st">"1999-12-31"</span>],</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">end =</span> average_close[date <span class="sc">==</span> <span class="st">"2024-11-29"</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="at">CAGR =</span> (end <span class="sc">/</span> start)<span class="sc">^</span>(<span class="dv">1</span> <span class="sc">/</span> <span class="dv">25</span>) <span class="sc">-</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  start   end   CAGR
  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
1  167.  602. 0.0525</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="do">### bond plot</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Bonds:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>BondMC <span class="ot">&lt;-</span> investments <span class="sc">%&gt;%</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Index <span class="sc">==</span> <span class="st">"Bond"</span>) <span class="sc">%&gt;%</span>            </span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n =</span> n_total, <span class="at">replace =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">resample_id =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span>n_boot, <span class="at">each =</span> n_samp)) <span class="sc">%&gt;%</span> </span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(resample_id) <span class="sc">%&gt;%</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">close =</span> <span class="fu">pmax</span>(<span class="dv">300</span>,close <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="fu">n</span>(), <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">400</span>))) <span class="sc">%&gt;%</span> <span class="co"># Add variation with min (from data)</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(date)</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>BondMC <span class="sc">%&gt;%</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(date <span class="sc">==</span> <span class="st">"1999-12-31"</span> <span class="sc">|</span> date <span class="sc">==</span> <span class="st">"2024-12-03"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(date) <span class="sc">%&gt;%</span> </span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">average_close =</span> <span class="fu">mean</span>(close)) <span class="sc">%&gt;%</span> </span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">start =</span> average_close[date <span class="sc">==</span> <span class="st">"1999-12-31"</span>],</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">end =</span> average_close[date <span class="sc">==</span> <span class="st">"2024-12-03"</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="at">CAGR =</span> (end <span class="sc">/</span> start)<span class="sc">^</span>(<span class="dv">1</span> <span class="sc">/</span> <span class="dv">25</span>) <span class="sc">-</span> <span class="dv">1</span>) <span class="do">### this value is a quite bit a lower</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  start   end   CAGR
  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
1  492. 1732. 0.0516</code></pre>
</div>
</div>
<p>Similarly we can plot:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>BondMC <span class="sc">%&gt;%</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(date <span class="sc">==</span> <span class="st">"2024-12-03"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> close))<span class="sc">+</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">30</span>, <span class="at">fill =</span> <span class="st">"blue"</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>)<span class="sc">+</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">1726</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span><span class="st">"Monte Carlo Simulated Bond Returns"</span>,<span class="at">x =</span> <span class="st">"Close Price (2024-11-28)"</span>, <span class="at">y =</span> <span class="st">"Freq."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp04_files/figure-html/bond plot-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>MID 400:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>midMC <span class="ot">&lt;-</span> investments <span class="sc">%&gt;%</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Index <span class="sc">==</span> <span class="st">"Midcap400"</span>) <span class="sc">%&gt;%</span>            </span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n =</span> n_total, <span class="at">replace =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">resample_id =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span>n_boot, <span class="at">each =</span> n_samp)) <span class="sc">%&gt;%</span> </span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(resample_id) <span class="sc">%&gt;%</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">close =</span> <span class="fu">pmax</span>(<span class="dv">70</span>,close <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="fu">n</span>(), <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">139</span>))) <span class="sc">%&gt;%</span> <span class="co"># Add variation with min (from data)</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(date)</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>midMC <span class="sc">%&gt;%</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(date <span class="sc">==</span> <span class="st">"1999-12-31"</span> <span class="sc">|</span> date <span class="sc">==</span> <span class="st">"2024-11-29"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(date) <span class="sc">%&gt;%</span> </span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">average_close =</span> <span class="fu">mean</span>(close)) <span class="sc">%&gt;%</span> </span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">start =</span> average_close[date <span class="sc">==</span> <span class="st">"1999-12-31"</span>],</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">end =</span> average_close[date <span class="sc">==</span> <span class="st">"2024-11-29"</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="at">CAGR =</span> (end <span class="sc">/</span> start)<span class="sc">^</span>(<span class="dv">1</span> <span class="sc">/</span> <span class="dv">25</span>) <span class="sc">-</span> <span class="dv">1</span>)<span class="co"># a bit lower</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  start   end   CAGR
  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
1  132.  616. 0.0636</code></pre>
</div>
</div>
<p>International Index, Fidelity International:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>n_boot <span class="ot">&lt;-</span> <span class="dv">6000</span>  <span class="co"># Number of bootstrap samples</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>n_samp <span class="ot">&lt;-</span> <span class="dv">1000</span> <span class="co"># Number of samples per bootstrap</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>n_total <span class="ot">&lt;-</span> n_boot <span class="sc">*</span> n_samp  <span class="co"># Total number of samples to generate</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>IN_MC <span class="ot">&lt;-</span> investments <span class="sc">%&gt;%</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Index <span class="sc">==</span><span class="st">"Fidelity International"</span>) <span class="sc">%&gt;%</span>            </span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n =</span> n_total, <span class="at">replace =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">resample_id =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span>n_boot, <span class="at">each =</span> n_samp)) <span class="sc">%&gt;%</span> </span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(resample_id) <span class="sc">%&gt;%</span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">close =</span> <span class="fu">pmax</span>(<span class="dv">28</span>,close <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="fu">n</span>(), <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">5</span>))) <span class="sc">%&gt;%</span> <span class="co"># Add variation with min (from data)</span></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(date)</span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>IN_MC <span class="sc">%&gt;%</span></span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(date <span class="sc">==</span> <span class="st">"2011-10-31"</span> <span class="sc">|</span> date <span class="sc">==</span> <span class="st">"2024-12-03"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(date) <span class="sc">%&gt;%</span> </span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">average_close =</span> <span class="fu">mean</span>(close)) <span class="sc">%&gt;%</span> </span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">start =</span> average_close[date <span class="sc">==</span> <span class="st">"2011-10-31"</span>],</span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">end =</span> average_close[date <span class="sc">==</span> <span class="st">"2024-12-03"</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="at">CAGR =</span> (end <span class="sc">/</span> start)<span class="sc">^</span>(<span class="dv">1</span> <span class="sc">/</span> <span class="dv">13</span>) <span class="sc">-</span> <span class="dv">1</span>)<span class="co"># slightly lower</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  start   end   CAGR
  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
1  33.0  50.9 0.0339</code></pre>
</div>
</div>
<p>Finally the T-bills:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>tbill_MC <span class="ot">&lt;-</span> tbills <span class="sc">%&gt;%</span> </span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n =</span> n_total, <span class="at">replace =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">resample_id =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span>n_boot, <span class="at">each =</span> n_samp)) <span class="sc">%&gt;%</span> </span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(resample_id) <span class="sc">%&gt;%</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">close_yield =</span> <span class="fu">pmax</span>(.<span class="dv">05</span>,close_yield <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="fu">n</span>(), <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="fl">1.85</span>))) <span class="sc">%&gt;%</span> <span class="co"># Add variation with min (from data)</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(date)</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>tbill_MC <span class="sc">%&gt;%</span> </span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">MC_growth_rate =</span> <span class="fu">mean</span>(close_yield))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 1
  MC_growth_rate
           &lt;dbl&gt;
1           2.48</code></pre>
</div>
</div>
<section id="incorporating-randomness" class="level4">
<h4 class="anchored" data-anchor-id="incorporating-randomness">Incorporating Randomness:</h4>
<p>Now that we have our adjusted values using the MC simulation we can use them in some new functions. These new functions will also incorporate simulation in of themselves, to allow us to gain a real understanding of what our returns might look like.</p>
<p><strong>TRS Simulation Function:</strong></p>
<p>Here, the same logic applies. Create a function that dynamically adjusts all the variables using a series of variables and loops, the only difference is we must include a stochastic element to it. In order to do this we will use the <code>rnorm</code> which generates random numbers following a normal distribution. Applying this function to the wage growth section of our function will do the trick. Note since we are adding this extra random “layer” we need an extra <code>for</code> loop, it is crucial that the variables are adjusted accordingly in the correct loop, or the intended effect will be missed. Compare both functions for more details. This uses the same arguments as before with an additional two, Number of Simulations: n_simulations and Salary Cap:maxed. This maxed is something that probably should have been added before, and it allows us to control a cap on salary growth for a more realistic approach (however we see soon if this even matters). This seems necessary since it is unlikely a persons salary will continue to grow and grow, especially since this metric is based on an overall average in US. If the cap is not required, it can simply be set to <code>Inf</code> making it “infinity”, or our computers version of infinity.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>MC_TRS <span class="ot">&lt;-</span> <span class="cf">function</span>(x,t,maxed,n_simulations){</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">123</span>)<span class="co">#common seed</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  sim_results <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n_simulations)<span class="co">#this initializes a vector, size of n_sims for better computing</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(sim <span class="cf">in</span> <span class="fu">seq</span>(<span class="dv">1</span>,n_simulations)){</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    salary_list <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    TRS <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>    current_sal <span class="ot">&lt;-</span> x</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>   <span class="co">#wage growth</span></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq</span>(<span class="dv">1</span>,t<span class="dv">-1</span>)){</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>      growth <span class="ot">&lt;-</span> (<span class="dv">1</span><span class="sc">+</span> <span class="fu">pmax</span>(<span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="at">mean =</span> .<span class="dv">045</span>, <span class="at">sd=</span><span class="fl">0.04</span>),<span class="dv">0</span>))</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>      current_sal <span class="ot">&lt;-</span> current_sal <span class="sc">*</span> growth</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>      current_sal<span class="ot">&lt;-</span> <span class="fu">min</span>(current_sal,maxed)<span class="co"># applies a realistic max sal</span></span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>      salary_list <span class="ot">&lt;-</span> <span class="fu">append</span>(salary_list,current_sal)<span class="co">#for FAS</span></span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>     <span class="co">#calc the yearly deposit to TRS</span></span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(current_sal<span class="sc">&gt;=</span> <span class="dv">55001</span> <span class="sc">&amp;</span> current_sal <span class="sc">&lt;=</span><span class="dv">75000</span>){<span class="co"># tier 1 salary</span></span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>         TRS <span class="ot">&lt;-</span> TRS <span class="sc">+</span> (current_sal <span class="sc">*</span> .<span class="dv">045</span>)</span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a>        }<span class="cf">else</span> <span class="cf">if</span>(current_sal<span class="sc">&gt;=</span> <span class="dv">75001</span> <span class="sc">&amp;</span> current_sal <span class="sc">&lt;=</span> <span class="dv">100000</span>){<span class="co"># tier 2 salary</span></span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a>              TRS <span class="ot">&lt;-</span> TRS <span class="sc">+</span> (current_sal <span class="sc">*</span> .<span class="dv">0575</span>)</span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a>        }<span class="cf">else</span>{<span class="co"># tier 3 salary</span></span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a>              TRS <span class="ot">&lt;-</span> TRS <span class="sc">+</span> (current_sal <span class="sc">*</span> .<span class="dv">06</span>)</span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb40-25"><a href="#cb40-25" aria-hidden="true" tabindex="-1"></a>    avg_TRS <span class="ot">&lt;-</span> TRS<span class="sc">/</span>t</span>
<span id="cb40-26"><a href="#cb40-26" aria-hidden="true" tabindex="-1"></a>     <span class="co">#benefit pay</span></span>
<span id="cb40-27"><a href="#cb40-27" aria-hidden="true" tabindex="-1"></a>    FAS <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">tail</span>(salary_list,<span class="dv">3</span>))</span>
<span id="cb40-28"><a href="#cb40-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(t <span class="sc">&lt;=</span> <span class="dv">20</span>){</span>
<span id="cb40-29"><a href="#cb40-29" aria-hidden="true" tabindex="-1"></a>        benefit_pay <span class="ot">&lt;-</span> .<span class="dv">0167</span> <span class="sc">*</span> FAS<span class="sc">*</span> t</span>
<span id="cb40-30"><a href="#cb40-30" aria-hidden="true" tabindex="-1"></a>        }<span class="cf">else</span> <span class="cf">if</span>(t <span class="sc">==</span> <span class="dv">20</span>){</span>
<span id="cb40-31"><a href="#cb40-31" aria-hidden="true" tabindex="-1"></a>           benefit_pay <span class="ot">&lt;-</span> .<span class="dv">0175</span> <span class="sc">*</span> FAS<span class="sc">*</span> t</span>
<span id="cb40-32"><a href="#cb40-32" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb40-33"><a href="#cb40-33" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>{</span>
<span id="cb40-34"><a href="#cb40-34" aria-hidden="true" tabindex="-1"></a>          benefit_pay <span class="ot">&lt;-</span> (.<span class="dv">35</span> <span class="sc">+</span>(.<span class="dv">02</span> <span class="sc">*</span> t)) <span class="sc">*</span> FAS</span>
<span id="cb40-35"><a href="#cb40-35" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb40-36"><a href="#cb40-36" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb40-37"><a href="#cb40-37" aria-hidden="true" tabindex="-1"></a>    monthly_income <span class="ot">&lt;-</span> benefit_pay<span class="sc">/</span><span class="dv">12</span></span>
<span id="cb40-38"><a href="#cb40-38" aria-hidden="true" tabindex="-1"></a>    sim_results[sim]<span class="ot">&lt;-</span> monthly_income</span>
<span id="cb40-39"><a href="#cb40-39" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb40-40"><a href="#cb40-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"MC Mean Monthly Salary: "</span>,<span class="fu">mean</span>(sim_results),<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>,<span class="st">"Average Contribution Yearly:"</span>,avg_TRS,<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb40-41"><a href="#cb40-41" aria-hidden="true" tabindex="-1"></a>      <span class="st">"__________________________________________________"</span>,<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb40-42"><a href="#cb40-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(sim_results)</span>
<span id="cb40-43"><a href="#cb40-43" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb40-44"><a href="#cb40-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-45"><a href="#cb40-45" aria-hidden="true" tabindex="-1"></a>TRS_x <span class="ot">&lt;-</span> <span class="fu">MC_TRS</span>(<span class="at">x =</span> <span class="dv">60000</span>,<span class="at">t =</span><span class="dv">25</span>,<span class="at">maxed =</span><span class="dv">200000</span>,<span class="at">n_simulations =</span> <span class="dv">3000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>MC Mean Monthly Salary:  12136.63 
 Average Contribution Yearly: 7432.814 
 __________________________________________________ </code></pre>
</div>
</div>
<p>Lets plot our results:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>TRS_sim <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Monthly_Income =</span> TRS_x)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>trs_mean_income <span class="ot">&lt;-</span><span class="fu">mean</span>(TRS_sim<span class="sc">$</span>Monthly_Income)</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(TRS_sim,<span class="fu">aes</span>(<span class="at">x =</span> Monthly_Income))<span class="sc">+</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">75</span>,<span class="at">fill=</span><span class="st">"purple"</span>,<span class="at">alpha=</span>.<span class="dv">5</span>)<span class="sc">+</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> trs_mean_income, <span class="at">color =</span> <span class="st">"red"</span>)<span class="sc">+</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_clean</span>()<span class="sc">+</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Monte Carlo Simulated Monthly Benefit TRS)"</span>,<span class="at">x =</span> <span class="st">"Monthly Income ($)"</span>, <span class="at">y =</span> <span class="st">"Freq."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp04_files/figure-html/TRS sim plot-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Quite an interesting result here, lets see the mean.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(trs_mean_income)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 12136.63</code></pre>
</div>
</div>
<p>Now lets remove the cap:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>TRS_x <span class="ot">&lt;-</span> <span class="fu">MC_TRS</span>(<span class="at">x =</span> <span class="dv">60000</span>,<span class="at">t =</span><span class="dv">25</span>,<span class="at">maxed =</span><span class="cn">Inf</span>,<span class="at">n_simulations =</span> <span class="dv">5000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>MC Mean Monthly Salary:  12411.99 
 Average Contribution Yearly: 6496.323 
 __________________________________________________ </code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>TRS_sim <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Monthly_Income =</span> TRS_x)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>trs_mean_income <span class="ot">&lt;-</span><span class="fu">mean</span>(TRS_sim<span class="sc">$</span>Monthly_Income)</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(TRS_sim,<span class="fu">aes</span>(<span class="at">x =</span> Monthly_Income))<span class="sc">+</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">75</span>,<span class="at">fill=</span><span class="st">"purple"</span>,<span class="at">alpha=</span>.<span class="dv">5</span>)<span class="sc">+</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> trs_mean_income, <span class="at">color =</span> <span class="st">"red"</span>)<span class="sc">+</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_clean</span>()<span class="sc">+</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Monte Carlo Simulated Monthly Benefit (TRS)"</span>,<span class="at">x =</span> <span class="st">"Monthly Income ($)"</span>, <span class="at">y =</span> <span class="st">"Freq."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp04_files/figure-html/plot no cap-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Resembles more of what a MC plot should like like. Lets see the mean again.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(trs_mean_income)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 12411.99</code></pre>
</div>
</div>
<p>The mean is barley different, which I find to be fascinating. Seems like adding a cap wasn’t the all that necessary.</p>
</section>
<section id="orp-simulation" class="level4">
<h4 class="anchored" data-anchor-id="orp-simulation">ORP Simulation</h4>
<p>This simulation again uses all the same core ideas, but gets more complicated when trying to add that random factor. Here we have to account for more than just growth rate simulation. We have to assure that all of the investment returns are also simulated. This become a bit more complex,and added loops need to be correctly implemented assuring the right variables are being iterated.</p>
<p>In order to simulate these returns we have to set these as variables in the start of our “working years” loop. This way at the start of each iteration (start of each year in practical terms) there will be a new randomized return rate to calculate our balance. Again this takes all the same arguments as before. Certain variables were added like <code>current_age</code> to account for the extra “simulation loop”. This was a tricky issue to deal with in the previous simulation function as well, where the salary was growing to extremely large numbers in to the e ^ 20 ranges because of one variable being added to for each iteration of every loop. Adding an extra variable like <code>current_age</code> or <code>current_sal</code> (for salary) allows these values to be reset at the start of every simulation loop and increment for the calculation loops, which is extremely important.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="do">#### ORP MONTE CARLO #####</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>MC_ORP<span class="ot">&lt;-</span> <span class="cf">function</span>(x,t,maxed,age,est_death,withdrawl_rate,n_simulations){</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set.seed</span>(<span class="dv">123</span>)<span class="co">#common seed</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>  sim_results <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n_simulations)</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a><span class="co">#inner functions</span></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>  personal_deposit <span class="ot">&lt;-</span> <span class="cf">function</span>(salary) {</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (salary <span class="sc">&gt;=</span> <span class="dv">55001</span> <span class="sc">&amp;</span> salary <span class="sc">&lt;=</span> <span class="dv">75000</span>){</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(salary <span class="sc">*</span> <span class="fl">0.045</span>)}</span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">if</span> (salary <span class="sc">&gt;</span> <span class="dv">75000</span> <span class="sc">&amp;</span> salary <span class="sc">&lt;=</span> <span class="dv">100000</span>){ </span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(salary <span class="sc">*</span> <span class="fl">0.0575</span>)}</span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>{ </span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(salary <span class="sc">*</span> <span class="fl">0.06</span>)}</span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a>  investment_return <span class="ot">&lt;-</span><span class="cf">function</span>(current_age,total_deposit,sp,md400,IN,bond,tbill){</span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(current_age <span class="sc">%in%</span> <span class="fu">seq</span>(<span class="dv">25</span>,<span class="dv">49</span>)){<span class="co">#us equities(split into sp500 &amp; mid400), foreign equities, bonds; respectively</span></span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a>      profit <span class="ot">&lt;-</span> ((total_deposit<span class="sc">*</span>.<span class="dv">27</span>)<span class="sc">*</span> sp) <span class="sc">+</span> </span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a>                ((total_deposit<span class="sc">*</span>.<span class="dv">27</span>)<span class="sc">*</span> md400) <span class="sc">+</span> </span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true" tabindex="-1"></a>                ((total_deposit<span class="sc">*</span>.<span class="dv">36</span>)<span class="sc">*</span> IN) <span class="sc">+</span> </span>
<span id="cb50-20"><a href="#cb50-20" aria-hidden="true" tabindex="-1"></a>                ((total_deposit<span class="sc">*</span>.<span class="dv">10</span>)<span class="sc">*</span> bond)</span>
<span id="cb50-21"><a href="#cb50-21" aria-hidden="true" tabindex="-1"></a>                <span class="fu">return</span>(profit)</span>
<span id="cb50-22"><a href="#cb50-22" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb50-23"><a href="#cb50-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">if</span>(current_age <span class="sc">%in%</span> <span class="fu">seq</span>(<span class="dv">50</span>,<span class="dv">59</span>)){</span>
<span id="cb50-24"><a href="#cb50-24" aria-hidden="true" tabindex="-1"></a>      profit <span class="ot">&lt;-</span> ((total_deposit<span class="sc">*</span>.<span class="dv">235</span>)<span class="sc">*</span> sp) <span class="sc">+</span> </span>
<span id="cb50-25"><a href="#cb50-25" aria-hidden="true" tabindex="-1"></a>                ((total_deposit<span class="sc">*</span>.<span class="dv">235</span>)<span class="sc">*</span> md400) <span class="sc">+</span> </span>
<span id="cb50-26"><a href="#cb50-26" aria-hidden="true" tabindex="-1"></a>                ((total_deposit<span class="sc">*</span>.<span class="dv">32</span>)<span class="sc">*</span> IN) <span class="sc">+</span> </span>
<span id="cb50-27"><a href="#cb50-27" aria-hidden="true" tabindex="-1"></a>                ((total_deposit<span class="sc">*</span>.<span class="dv">21</span>)<span class="sc">*</span> bond)</span>
<span id="cb50-28"><a href="#cb50-28" aria-hidden="true" tabindex="-1"></a>                <span class="fu">return</span>(profit)</span>
<span id="cb50-29"><a href="#cb50-29" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb50-30"><a href="#cb50-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">if</span>(current_age <span class="sc">%in%</span> <span class="fu">seq</span>(<span class="dv">60</span>,<span class="dv">74</span>)){</span>
<span id="cb50-31"><a href="#cb50-31" aria-hidden="true" tabindex="-1"></a>      profit <span class="ot">&lt;-</span>((total_deposit<span class="sc">*</span>.<span class="dv">17</span>)<span class="sc">*</span> sp) <span class="sc">+</span> </span>
<span id="cb50-32"><a href="#cb50-32" aria-hidden="true" tabindex="-1"></a>                ((total_deposit<span class="sc">*</span>.<span class="dv">17</span>)<span class="sc">*</span> md400) <span class="sc">+</span> </span>
<span id="cb50-33"><a href="#cb50-33" aria-hidden="true" tabindex="-1"></a>                ((total_deposit<span class="sc">*</span>.<span class="dv">23</span>)<span class="sc">*</span> IN) <span class="sc">+</span> </span>
<span id="cb50-34"><a href="#cb50-34" aria-hidden="true" tabindex="-1"></a>                ((total_deposit<span class="sc">*</span>.<span class="dv">43</span>)<span class="sc">*</span> bond)</span>
<span id="cb50-35"><a href="#cb50-35" aria-hidden="true" tabindex="-1"></a>                <span class="fu">return</span>(profit)</span>
<span id="cb50-36"><a href="#cb50-36" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb50-37"><a href="#cb50-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="cf">if</span>(current_age <span class="sc">&gt;</span> <span class="dv">74</span>){<span class="co">#us equities(split into sp500 &amp; mid400), foreign equities, bonds,treasury; respectively</span></span>
<span id="cb50-38"><a href="#cb50-38" aria-hidden="true" tabindex="-1"></a>      profit <span class="ot">&lt;-</span> ((total_deposit<span class="sc">*</span>.<span class="dv">095</span>)<span class="sc">*</span> sp) <span class="sc">+</span> </span>
<span id="cb50-39"><a href="#cb50-39" aria-hidden="true" tabindex="-1"></a>                ((total_deposit<span class="sc">*</span>.<span class="dv">095</span>)<span class="sc">*</span> md400) <span class="sc">+</span> </span>
<span id="cb50-40"><a href="#cb50-40" aria-hidden="true" tabindex="-1"></a>                ((total_deposit<span class="sc">*</span>.<span class="dv">13</span>)<span class="sc">*</span> IN) <span class="sc">+</span> </span>
<span id="cb50-41"><a href="#cb50-41" aria-hidden="true" tabindex="-1"></a>                ((total_deposit<span class="sc">*</span>.<span class="dv">62</span>)<span class="sc">*</span> bond) <span class="sc">+</span> </span>
<span id="cb50-42"><a href="#cb50-42" aria-hidden="true" tabindex="-1"></a>                ((total_deposit <span class="sc">*</span>.<span class="dv">06</span>)<span class="sc">*</span> tbill)</span>
<span id="cb50-43"><a href="#cb50-43" aria-hidden="true" tabindex="-1"></a>                <span class="fu">return</span>(profit)</span>
<span id="cb50-44"><a href="#cb50-44" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb50-45"><a href="#cb50-45" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb50-46"><a href="#cb50-46" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb50-47"><a href="#cb50-47" aria-hidden="true" tabindex="-1"></a>   <span class="cf">for</span>(sim <span class="cf">in</span> <span class="fu">seq</span>(<span class="dv">1</span>,n_simulations)){ <span class="co"># MC LOOP</span></span>
<span id="cb50-48"><a href="#cb50-48" aria-hidden="true" tabindex="-1"></a>      years_worked<span class="ot">&lt;-</span><span class="dv">0</span> </span>
<span id="cb50-49"><a href="#cb50-49" aria-hidden="true" tabindex="-1"></a>      total_deposit<span class="ot">&lt;-</span><span class="dv">0</span></span>
<span id="cb50-50"><a href="#cb50-50" aria-hidden="true" tabindex="-1"></a>      death_balance <span class="ot">&lt;-</span> <span class="fu">numeric</span>(n_simulations)</span>
<span id="cb50-51"><a href="#cb50-51" aria-hidden="true" tabindex="-1"></a>      current_age <span class="ot">&lt;-</span> age</span>
<span id="cb50-52"><a href="#cb50-52" aria-hidden="true" tabindex="-1"></a>      TRS <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb50-53"><a href="#cb50-53" aria-hidden="true" tabindex="-1"></a>      profit <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb50-54"><a href="#cb50-54" aria-hidden="true" tabindex="-1"></a>      retirment_age <span class="ot">&lt;-</span> age<span class="sc">+</span>t</span>
<span id="cb50-55"><a href="#cb50-55" aria-hidden="true" tabindex="-1"></a>      sal_after_r <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb50-56"><a href="#cb50-56" aria-hidden="true" tabindex="-1"></a>      average_annual <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb50-57"><a href="#cb50-57" aria-hidden="true" tabindex="-1"></a>  <span class="co"># while working calc</span></span>
<span id="cb50-58"><a href="#cb50-58" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq</span>(<span class="dv">1</span>, t)){</span>
<span id="cb50-59"><a href="#cb50-59" aria-hidden="true" tabindex="-1"></a>      current_sal <span class="ot">&lt;-</span> x</span>
<span id="cb50-60"><a href="#cb50-60" aria-hidden="true" tabindex="-1"></a>      growth <span class="ot">&lt;-</span>(<span class="dv">1</span><span class="sc">+</span> <span class="fu">pmax</span>(<span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="at">mean =</span> .<span class="dv">045</span>, <span class="at">sd=</span><span class="fl">0.04</span>),<span class="dv">0</span>))</span>
<span id="cb50-61"><a href="#cb50-61" aria-hidden="true" tabindex="-1"></a>      current_sal <span class="ot">&lt;-</span> current_sal<span class="sc">*</span>growth</span>
<span id="cb50-62"><a href="#cb50-62" aria-hidden="true" tabindex="-1"></a>      current_sal <span class="ot">&lt;-</span> <span class="fu">min</span>(current_sal,maxed)</span>
<span id="cb50-63"><a href="#cb50-63" aria-hidden="true" tabindex="-1"></a>      current_age <span class="ot">&lt;-</span> current_age <span class="sc">+</span><span class="dv">1</span></span>
<span id="cb50-64"><a href="#cb50-64" aria-hidden="true" tabindex="-1"></a>      years_worked<span class="ot">&lt;-</span> years_worked <span class="sc">+</span> <span class="dv">1</span> </span>
<span id="cb50-65"><a href="#cb50-65" aria-hidden="true" tabindex="-1"></a>      <span class="co">#introducing randomness into our returns</span></span>
<span id="cb50-66"><a href="#cb50-66" aria-hidden="true" tabindex="-1"></a>      sp <span class="ot">&lt;-</span> (<span class="dv">1</span><span class="sc">+</span> <span class="fu">pmax</span>(<span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="at">mean =</span> <span class="fl">0.0526</span>, <span class="at">sd=</span><span class="fl">0.03</span>),<span class="dv">0</span>))</span>
<span id="cb50-67"><a href="#cb50-67" aria-hidden="true" tabindex="-1"></a>      md400 <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">pmax</span>(<span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="at">mean =</span><span class="fl">0.0695</span>,<span class="at">sd =</span> .<span class="dv">03</span>),<span class="dv">0</span>))</span>
<span id="cb50-68"><a href="#cb50-68" aria-hidden="true" tabindex="-1"></a>      IN <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">pmax</span>(<span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="at">mean =</span><span class="fl">0.0334</span>,<span class="at">sd =</span> .<span class="dv">03</span>),<span class="dv">0</span>))</span>
<span id="cb50-69"><a href="#cb50-69" aria-hidden="true" tabindex="-1"></a>      bond<span class="ot">&lt;-</span>(<span class="dv">1</span> <span class="sc">+</span> <span class="fu">pmax</span>(<span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="at">mean =</span><span class="fl">0.0513</span>,<span class="at">sd =</span> .<span class="dv">03</span>),<span class="dv">0</span>))</span>
<span id="cb50-70"><a href="#cb50-70" aria-hidden="true" tabindex="-1"></a>      tbill<span class="ot">&lt;-</span>(<span class="dv">1</span> <span class="sc">+</span> <span class="fu">pmax</span>(<span class="fu">rnorm</span>(<span class="dv">1</span>,<span class="at">mean =</span>.<span class="dv">0248</span>,<span class="at">sd =</span> .<span class="dv">015</span>),<span class="dv">0</span>))</span>
<span id="cb50-71"><a href="#cb50-71" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb50-72"><a href="#cb50-72" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(years_worked <span class="sc">&lt;=</span> <span class="dv">7</span>){</span>
<span id="cb50-73"><a href="#cb50-73" aria-hidden="true" tabindex="-1"></a>           total_deposit <span class="ot">&lt;-</span> total_deposit <span class="sc">+</span> <span class="fu">personal_deposit</span>(current_sal) <span class="sc">+</span> .<span class="dv">08</span><span class="sc">*</span>current_sal</span>
<span id="cb50-74"><a href="#cb50-74" aria-hidden="true" tabindex="-1"></a>      }<span class="cf">else</span>{</span>
<span id="cb50-75"><a href="#cb50-75" aria-hidden="true" tabindex="-1"></a>        total_deposit <span class="ot">&lt;-</span> total_deposit <span class="sc">+</span> <span class="fu">personal_deposit</span>(current_sal) <span class="sc">+</span> .<span class="dv">10</span><span class="sc">*</span>current_sal</span>
<span id="cb50-76"><a href="#cb50-76" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb50-77"><a href="#cb50-77" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb50-78"><a href="#cb50-78" aria-hidden="true" tabindex="-1"></a>      balance <span class="ot">&lt;-</span> total_deposit <span class="sc">+</span> <span class="fu">investment_return</span>(<span class="at">current_age =</span> current_age,</span>
<span id="cb50-79"><a href="#cb50-79" aria-hidden="true" tabindex="-1"></a>                                                   <span class="at">total_deposit =</span> total_deposit,</span>
<span id="cb50-80"><a href="#cb50-80" aria-hidden="true" tabindex="-1"></a>                                                   <span class="at">sp =</span> sp,</span>
<span id="cb50-81"><a href="#cb50-81" aria-hidden="true" tabindex="-1"></a>                                                   <span class="at">md400 =</span> md400,</span>
<span id="cb50-82"><a href="#cb50-82" aria-hidden="true" tabindex="-1"></a>                                                   <span class="at">IN =</span> IN,</span>
<span id="cb50-83"><a href="#cb50-83" aria-hidden="true" tabindex="-1"></a>                                                   <span class="at">bond =</span> bond,</span>
<span id="cb50-84"><a href="#cb50-84" aria-hidden="true" tabindex="-1"></a>                                                   <span class="at">tbill =</span> tbill)</span>
<span id="cb50-85"><a href="#cb50-85" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb50-86"><a href="#cb50-86" aria-hidden="true" tabindex="-1"></a>    } <span class="co">#retirement calculations</span></span>
<span id="cb50-87"><a href="#cb50-87" aria-hidden="true" tabindex="-1"></a>      <span class="cf">while</span> (current_age <span class="sc">&lt;</span> est_death) {</span>
<span id="cb50-88"><a href="#cb50-88" aria-hidden="true" tabindex="-1"></a>      current_age <span class="ot">&lt;-</span> current_age <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb50-89"><a href="#cb50-89" aria-hidden="true" tabindex="-1"></a>      withdraw <span class="ot">&lt;-</span> balance <span class="sc">*</span> withdrawl_rate</span>
<span id="cb50-90"><a href="#cb50-90" aria-hidden="true" tabindex="-1"></a>      sal_after_r <span class="ot">&lt;-</span> <span class="fu">append</span>(sal_after_r,withdraw)</span>
<span id="cb50-91"><a href="#cb50-91" aria-hidden="true" tabindex="-1"></a>      balance <span class="ot">&lt;-</span> balance <span class="sc">-</span> withdraw</span>
<span id="cb50-92"><a href="#cb50-92" aria-hidden="true" tabindex="-1"></a>      balance <span class="ot">&lt;-</span> balance <span class="sc">+</span> <span class="fu">investment_return</span>(<span class="at">current_age =</span> current_age,</span>
<span id="cb50-93"><a href="#cb50-93" aria-hidden="true" tabindex="-1"></a>                                                   <span class="at">total_deposit =</span> total_deposit,</span>
<span id="cb50-94"><a href="#cb50-94" aria-hidden="true" tabindex="-1"></a>                                                   <span class="at">sp =</span> sp,</span>
<span id="cb50-95"><a href="#cb50-95" aria-hidden="true" tabindex="-1"></a>                                                   <span class="at">md400 =</span> md400,</span>
<span id="cb50-96"><a href="#cb50-96" aria-hidden="true" tabindex="-1"></a>                                                   <span class="at">IN =</span> IN,</span>
<span id="cb50-97"><a href="#cb50-97" aria-hidden="true" tabindex="-1"></a>                                                   <span class="at">bond =</span> bond,</span>
<span id="cb50-98"><a href="#cb50-98" aria-hidden="true" tabindex="-1"></a>                                                   <span class="at">tbill =</span> tbill)</span>
<span id="cb50-99"><a href="#cb50-99" aria-hidden="true" tabindex="-1"></a>         </span>
<span id="cb50-100"><a href="#cb50-100" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb50-101"><a href="#cb50-101" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb50-102"><a href="#cb50-102" aria-hidden="true" tabindex="-1"></a>         average_annual <span class="ot">&lt;-</span> <span class="fu">mean</span>(sal_after_r)</span>
<span id="cb50-103"><a href="#cb50-103" aria-hidden="true" tabindex="-1"></a>         sim_results[sim]<span class="ot">&lt;-</span> average_annual<span class="sc">/</span><span class="dv">12</span></span>
<span id="cb50-104"><a href="#cb50-104" aria-hidden="true" tabindex="-1"></a>   }</span>
<span id="cb50-105"><a href="#cb50-105" aria-hidden="true" tabindex="-1"></a>  death_balance[sim]<span class="ot">&lt;-</span> balance</span>
<span id="cb50-106"><a href="#cb50-106" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Avg Balance at Death"</span>,<span class="fu">mean</span>(death_balance),<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb50-107"><a href="#cb50-107" aria-hidden="true" tabindex="-1"></a> <span class="fu">return</span>(sim_results)</span>
<span id="cb50-108"><a href="#cb50-108" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb50-109"><a href="#cb50-109" aria-hidden="true" tabindex="-1"></a><span class="co">#using 7.5 percent</span></span>
<span id="cb50-110"><a href="#cb50-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-111"><a href="#cb50-111" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"4% Rate of Withdrawl </span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>4% Rate of Withdrawl </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>orp_x <span class="ot">&lt;-</span> <span class="fu">MC_ORP</span>(<span class="at">x =</span> <span class="dv">60000</span>,</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">age =</span> <span class="dv">30</span>,</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">t =</span> <span class="dv">30</span>,</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">maxed =</span> <span class="cn">Inf</span>,</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">est_death=</span> <span class="dv">80</span>,</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">withdrawl_rate =</span> .<span class="dv">04</span>,</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>                <span class="at">n_simulations =</span> <span class="dv">5000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Avg Balance at Death 804.6578 </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"7.5% Rate of Withdrawl </span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>7.5% Rate of Withdrawl </code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>orp_x <span class="ot">&lt;-</span> <span class="fu">MC_ORP</span>(<span class="at">x =</span> <span class="dv">60000</span>,</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">age =</span> <span class="dv">30</span>,</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">t =</span> <span class="dv">30</span>,</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">maxed =</span> <span class="cn">Inf</span>,</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">est_death=</span> <span class="dv">80</span>,</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">withdrawl_rate =</span> .<span class="dv">075</span>,</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>                <span class="at">n_simulations =</span> <span class="dv">5000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Avg Balance at Death 593.7889 </code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>ORP_sim <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Monthly_Income =</span> orp_x)</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>ORP_mean_income <span class="ot">&lt;-</span><span class="fu">mean</span>(ORP_sim<span class="sc">$</span>Monthly_Income)</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a><span class="do">### MC PLOT</span></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(ORP_sim,<span class="fu">aes</span>(<span class="at">x =</span> Monthly_Income))<span class="sc">+</span></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">75</span>,<span class="at">fill=</span><span class="st">"purple"</span>,<span class="at">alpha=</span>.<span class="dv">5</span>)<span class="sc">+</span></span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> ORP_mean_income, <span class="at">color =</span> <span class="st">"red"</span>)<span class="sc">+</span></span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_clean</span>()<span class="sc">+</span></span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Monte Carlo Simulated Monthly Benefit (ORP)"</span>,<span class="at">x =</span> <span class="st">"Monthly Income at 7.5% Withdrawal ($)"</span>, </span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Freq."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="mp04_files/figure-html/ORP simulation plot-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="which-to-choose" class="level3">
<h3 class="anchored" data-anchor-id="which-to-choose">Which to choose?</h3>
<p>Its not easy to see which ones would benefit us more. However if we were to look at the distributions of both the methods (uncapped) we see that the ORP method seems to resemble more of a normal distribution centering around the mean more. However the TRS method seems to skew towards the higher ends a bit. This might seem like a good reason to choose the TRS however we must recall that this is under the assumption that the salary keeps growing at the rate shown yearly. So this skewing might be unlikely in reality. It is also important to note that there are slightly more frequencies <em>less than the mean</em>. With the ORP this is the opposite, the majority of the returns were higher than the mean. The ORP method even with 7.5 percent withdrawal amount we can still give a little from this fund to family, even if it is an insignificant amount, with TRS we can not. Lets take an exact look at the means below.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">'ORP Mean'</span>,ORP_mean_income,<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>,<span class="st">"TRS Mean"</span>,trs_mean_income)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>ORP Mean 12758.64 
 TRS Mean 12411.99</code></pre>
</div>
</div>
<p>Seem like the ORP mean is more and with a better distribution it seems the better choice.</p>
<p>NOTE: You’ll be able to play with simulation yourself here once the shinny app is posted.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/Harry-2099\.github\.io\/STA9750-2024-FALL\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>